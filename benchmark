#!/bin/bash
echo "Each language reports file count and time elapsed for CONDA_PREFIX"
echo
echo "| Language (options) | Sanity chk  | Wall clock time"
echo "|--------------------|-------------|----------------"

JULIA_NUM_THREADS=$(nproc)
NODE_OPTIONS="--max-old-space-size=8192"
CP=$CONDA_PREFIX

#echo -n "| Ruby              "
#start=$(date +%s)
#ruby/find-dups $CP 2>/dev/null >find-dups.ruby
#dups=$(grep '^  ' find-dups.ruby | wc -l)
#end=$(date +%s)
#secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
#echo " | dups $dups | $secs"

echo -n "| Python            "
start=$(date +%s)
python/find-dups $CP >find-dups.python 2>/dev/null
dups=$(grep '^  ' find-dups.python | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "| Golang            "
start=$(date +%s)
golang/find-dups/find-dups $CP 2>/dev/null >find-dups.golang
dups=$(grep '^  ' find-dups.golang | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "| Julia             "
start=$(date +%s)
julia/find-dups $CP 2>/dev/null >find-dups.julia 
dups=$(grep '^  ' find-dups.julia | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "| Haskell           "
start=$(date +%s)
haskell/find-dups $CP 2>/dev/null >find-dups.haskell
dups=$(grep '^  ' find-dups.haskell | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "| Rust (rust-crypto)"
cd rust/find-dups-rust-crypto >/dev/null
cargo build --release 2>/dev/null >/dev/null
cd - >/dev/null
start=$(date +%s)
rust/find-dups-rust-crypto/target/release/find-dups $CP 2>/dev/null >find-dups.rust1
dups=$(grep '^  ' find-dups.rust1 | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "| Rust (RustCrypto) "
cd rust/find-dups-RustCrypto >/dev/null
cargo build --release 2>/dev/null >/dev/null
cd - >/dev/null
start=$(date +%s)
rust/find-dups-RustCrypto/target/release/find-dups $CP 2>/dev/null >find-dups.rust2
dups=$(grep '^  ' find-dups.rust2 | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "| TypeScript ->.js  "
cd typescript >/dev/null
tsc find-dups.ts
cd - >/dev/null
start=$(date +%s)
typescript/find-dups.js $CP 2>/dev/null >find-dups.typescript
dups=$(grep '^  ' find-dups.typescript | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

# Far too slow to run very much
#echo -n "Bash"
#start=$(date +%s)
#bash/find-dups $CP >find-dups.bash
#dups=$(grep '^  ' find-dups.bash | wc -l)
#end=$(date +%s)
#secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
#echo " | dups $dups | $secs"

