#!/bin/bash
echo "Each language reports file count and time elapsed for CONDA_PREFIX"
echo

JULIA_NUM_THREADS=$(nproc)
NODE_OPTIONS="--max-old-space-size=8192"
CP=$CONDA_PREFIX

echo -n "Golang            "
start=$(date +%s)
golang/find-dups/find-dups $CP 2>/dev/null >find-dups.golang 
dups=$(grep '^  ' find-dups.golang | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "Haskell           "
start=$(date +%s)
haskell/find-dups $CP 2>/dev/null >find-dups.haskell
dups=$(grep '^  ' find-dups.haskell | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "Python (scandir)  "
start=$(date +%s)
python/find-dups -m1 -i -p -s $CP >find-dups.pyscandir 2>/dev/null
dups=$(grep '^  ' find-dups.pyscandir | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "Python (parallel) "
start=$(date +%s)
python/find-dups -m1 -i -p $CP >find-dups.pyparallel 2>/dev/null
dups=$(grep '^  ' find-dups.pyparallel | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "Python (serial)   "
start=$(date +%s)
python/find-dups -m1 -i $CP >find-dups.python 2>/dev/null
dups=$(grep '^  ' find-dups.python | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "Julia             "
start=$(date +%s)
julia/find-dups $CP 2>/dev/null >find-dups.julia 
dups=$(grep '^  ' find-dups.golang | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "Rust (rust-crypto)"
start=$(date +%s)
rust/find-dups-rust-crypto/target/release/find-dups $CP 2>/dev/null >find-dups.rust
dups=$(grep '^  ' find-dups.rust | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "Rust (RustCrypto) "
start=$(date +%s)
rust/find-dups-RustCrypto/target/release/find-dups $CP 2>/dev/null >find-dups.rust
dups=$(grep '^  ' find-dups.rust | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

echo -n "TypeScript ->.js  "
cd typescript >/dev/null
tsc find-dups.ts
cd - >/dev/null
start=$(date +%s)
typescript/find-dups.js $CP 2>/dev/null >find-dups.typescript
dups=$(grep '^  ' find-dups.typescript | wc -l)
end=$(date +%s)
secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
echo " | dups $dups | $secs"

# Far too slow to run very much
#echo -n "Bash"
#start=$(date +%s)
#bash/find-dups $CP >find-dups.bash
#dups=$(grep '^  ' find-dups.bash | wc -l)
#end=$(date +%s)
#secs=$(numfmt --to=si --suffix=" secs" $(($end-$start)))
#echo " | dups $dups | $secs"

